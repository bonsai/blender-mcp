# LegoDesigner V3 - Flask QR Access Implementation

## ğŸ¯ æ¦‚è¦

Flask Web Server ã« QR ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚å­ä¾›ãŒãƒ–ãƒ©ã‚¦ã‚¶ã§ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€QR ã‚³ãƒ¼ãƒ‰ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å…±æœ‰ã§ãã¾ã™ã€‚

```
ãƒ–ãƒ©ã‚¦ã‚¶ (QR ã‚¹ã‚­ãƒ£ãƒ³)
    â†“
Flask Web Server (QR ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ)
    â†“
ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† (JSON)
    â†“
ãƒãƒ£ãƒƒãƒˆãƒ»3Dç”Ÿæˆ
```

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ä¾å­˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
cd v3
pip install -r requirements.txt
```

### 2. Flask ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

```bash
python app.py
```

ã¾ãŸã¯ Makefile ã‚’ä½¿ç”¨:

```bash
make dev
```

### 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹

```
http://localhost:5000
```

---

## ğŸ“± QR ã‚³ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼

### 1. æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ

```
http://localhost:5000/new
```

â†“

- QR ã‚³ãƒ¼ãƒ‰è¡¨ç¤º
- ã‚»ãƒƒã‚·ãƒ§ãƒ³IDè¡¨ç¤º
- ãƒãƒ£ãƒƒãƒˆé–‹å§‹ãƒœã‚¿ãƒ³

### 2. QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³

ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ QR ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³

â†“

```
http://localhost:5000/join/{session_id}
```

### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å‚åŠ 

è‡ªå‹•çš„ã«ãƒãƒ£ãƒƒãƒˆç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

â†“

```
http://localhost:5000/chat/{session_id}
```

---

## ğŸ—ï¸ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
v3/
â”œâ”€â”€ app.py                      # Flask ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼ˆQRæ©Ÿèƒ½ä»˜ãï¼‰
â”œâ”€â”€ requirements.txt            # Python ä¾å­˜
â”œâ”€â”€ Makefile                    # ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ index.html             # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ new_session.html       # æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆQRè¡¨ç¤ºï¼‰
â”‚   â”œâ”€â”€ chat.html              # ãƒãƒ£ãƒƒãƒˆç”»é¢
â”‚   â”œâ”€â”€ preview.html           # 3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
â”‚   â”œâ”€â”€ order.html             # ç™ºæ³¨ãƒ•ãƒ­ãƒ¼
â”‚   â””â”€â”€ error.html             # ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸
â”‚
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ app.js
â”‚   â”‚   â”œâ”€â”€ chat.js
â”‚   â”‚   â””â”€â”€ api.js
â”‚   â””â”€â”€ images/
â”‚
â””â”€â”€ data/
    â”œâ”€â”€ sessions/              # ã‚»ãƒƒã‚·ãƒ§ãƒ³ JSON
    â”œâ”€â”€ models/                # 3D ãƒ¢ãƒ‡ãƒ«
    â”œâ”€â”€ orders/                # ç™ºæ³¨ãƒ‡ãƒ¼ã‚¿
    â””â”€â”€ qr_codes/              # QR ã‚³ãƒ¼ãƒ‰ç”»åƒ
```

---

## ğŸ”‘ ä¸»è¦æ©Ÿèƒ½

### 1. QR ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

```python
def generate_qr_code(session_id: str, host: str, port: int) -> str:
    """QR ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰"""
    url = f"http://{host}:{port}/join/{session_id}"
    # QR ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå‡¦ç†
    return base64_encoded_image
```

**ä½¿ç”¨ä¾‹:**

```bash
GET /api/session/qr/{session_id}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "status": "success",
  "session_id": "lego-20260106-101530-a1b2c3d4",
  "qr_code": "data:image/png;base64,iVBORw0KGgoAAAANS..."
}
```

### 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

```python
def create_session() -> str:
    """æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ"""
    session_id = f"lego-{date}-{time}-{uuid}"
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ JSON ã§ä¿å­˜
    return session_id
```

**ã‚»ãƒƒã‚·ãƒ§ãƒ³ JSON å½¢å¼:**

```json
{
  "session_id": "lego-20260106-101530-a1b2c3d4",
  "created_at": "2026-01-06T10:15:30Z",
  "messages": [],
  "models": [],
  "orders": []
}
```

### 3. ãƒãƒ£ãƒƒãƒˆ API

```python
@app.route('/api/chat/send', methods=['POST'])
def api_chat_send():
    """ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡"""
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**

```json
{
  "session_id": "lego-20260106-101530-a1b2c3d4",
  "message": "èµ¤ã„ãƒ¬ã‚´ã®å®¶ã‚’ä½œã£ã¦"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "status": "success",
  "message_id": "msg-001",
  "timestamp": "2026-01-06T10:15:35Z"
}
```

### 4. ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ ãƒ•ãƒ­ãƒ¼

```
/new
  â†“ (QR ã‚³ãƒ¼ãƒ‰è¡¨ç¤º)
/join/{session_id}
  â†“ (è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ)
/chat/{session_id}
  â†“ (ãƒãƒ£ãƒƒãƒˆé–‹å§‹)
```

---

## ğŸ“Š API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---|---|---|
| GET | `/api/session/info/{session_id}` | ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±å–å¾— |
| GET | `/api/session/qr/{session_id}` | QR ã‚³ãƒ¼ãƒ‰å–å¾— |

### ãƒãƒ£ãƒƒãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---|---|---|
| POST | `/api/chat/send` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ |
| GET | `/api/chat/history/{session_id}` | å±¥æ­´å–å¾— |

### ãƒ¢ãƒ‡ãƒ«

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---|---|---|
| POST | `/api/model/create` | ãƒ¢ãƒ‡ãƒ«ä½œæˆ |
| GET | `/api/model/list/{session_id}` | ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ |

### ç™ºæ³¨

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---|---|---|
| POST | `/api/order/create` | ç™ºæ³¨ä½œæˆ |
| GET | `/api/order/list/{session_id}` | ç™ºæ³¨ä¸€è¦§ |

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---|---|---|
| GET | `/api/health` | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ |

---

## ğŸ¨ UI/UX

### ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  LegoDesigner             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚ [æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³] [å‚åŠ ]     â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  LegoDesigner             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   [QR ã‚³ãƒ¼ãƒ‰]           â”‚ â”‚
â”‚ â”‚   ğŸ“± ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦å‚åŠ    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚ Session: lego-001           â”‚
â”‚ [ğŸ“‹ ã‚³ãƒ”ãƒ¼]                 â”‚
â”‚                             â”‚
â”‚ [ğŸ’¬ ãƒãƒ£ãƒƒãƒˆé–‹å§‹]           â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒãƒ£ãƒƒãƒˆç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  LegoDesigner | Session: lego-001 [ğŸ“±] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ [AI] ã“ã‚“ã«ã¡ã¯ï¼ä½•ã‚’ä½œã‚ŠãŸã„ï¼Ÿ        â”‚
â”‚                                         â”‚
â”‚ [You] èµ¤ã„ãƒ¬ã‚´ã®å®¶ã‚’ä½œã£ã¦             â”‚
â”‚                                         â”‚
â”‚ [AI] èµ¤ã„ãƒ¬ã‚´ã®å®¶ã‚’ä½œã‚Šã¾ã—ãŸï¼        â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¥åŠ›æ¬„] [é€ä¿¡]                         â”‚
â”‚                                         â”‚
â”‚ ğŸ“¦ ä½œæˆã—ãŸãƒ¢ãƒ‡ãƒ«                       â”‚
â”‚ [ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰] [ğŸ’³ ç™ºæ³¨ã™ã‚‹]        â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```bash
make test
```

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

1. **æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ**

```bash
curl http://localhost:5000/new
```

2. **QR ã‚³ãƒ¼ãƒ‰å–å¾—**

```bash
curl http://localhost:5000/api/session/qr/lego-001
```

3. **ãƒãƒ£ãƒƒãƒˆé€ä¿¡**

```bash
curl -X POST http://localhost:5000/api/chat/send \
  -H "Content-Type: application/json" \
  -d '{"session_id":"lego-001","message":"ãƒ†ã‚¹ãƒˆ"}'
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤

### Docker

```bash
make docker-build
make docker-run
```

### Gunicorn (æœ¬ç•ª)

```bash
gunicorn -w 4 -b 0.0.0.0:5000 v3.app:app
```

---

## ğŸ“ ç’°å¢ƒå¤‰æ•°

```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«
PORT=5000
DEBUG=True
SECRET_KEY=your-secret-key
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- ã‚»ãƒƒã‚·ãƒ§ãƒ³ID ã¯ UUID ã§ä¸€æ„
- QR ã‚³ãƒ¼ãƒ‰ã¯ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
- CORS æœ‰åŠ¹åŒ–
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ TTL: 30æ—¥

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿å½¢å¼

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ JSON

```json
{
  "session_id": "lego-20260106-101530-a1b2c3d4",
  "created_at": "2026-01-06T10:15:30Z",
  "messages": [
    {
      "id": "msg-001",
      "timestamp": "2026-01-06T10:15:35Z",
      "role": "user",
      "content": "èµ¤ã„ãƒ¬ã‚´ã®å®¶ã‚’ä½œã£ã¦"
    }
  ],
  "models": [],
  "orders": []
}
```

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- [ ] 3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè£… (Three.js)
- [ ] Blender é€£æº
- [ ] Go å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
- [ ] ç™ºæ³¨ãƒ•ãƒ­ãƒ¼
- [ ] MLå­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:

1. ãƒ­ã‚°ã‚’ç¢ºèª: `logs/app.log`
2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: `GET /api/health`
3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª: `GET /api/session/info/{session_id}`

---

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
