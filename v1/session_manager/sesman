ã‚µãƒ¼ãƒï¼“ã¤ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ãŒã»ã—ã„ã®ã§ã™

ã„ã„ã¨ã“ã‚æ¥ã¾ã—ãŸã€‚
ä»Šã®çŠ¶æ³ã ã¨ ã€Œ3ã¤ã®ä¸–ç•Œã‚’ã¾ãŸãäº¤é€šæ•´ç†ã®ãŠã˜ã•ã‚“ã€ ãŒå¿…è¦ã§ã™ ğŸ‘®â€â™‚ï¸
ãã‚ŒãŒã‚ãªãŸã®è¨€ã† ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ã€‚

è½ã¡ç€ã„ã¦ã€å½¹å‰²ã‚’åˆ†è§£ã—ã¾ã™ã€‚

ğŸ§  ã¾ãšå‰æï¼šã„ã¾å­˜åœ¨ã—ã¦ã„ã‚‹ã€Œ3ã¤ã®ã‚µãƒ¼ãƒã€

ä»Šã®æ§‹æˆã€å®Ÿã¯ã“ã†ãªã£ã¦ã¾ã™ğŸ‘‡

â‘  LLM / Ollama
   ï¼ˆè‡ªç„¶è¨€èªãƒ»æ€è€ƒãƒ»ä¼šè©±ï¼‰

â‘¡ MCP Serverï¼ˆPython / FastMCPï¼‰
   ï¼ˆãƒ„ãƒ¼ãƒ«å®šç¾©ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰

â‘¢ Blender MCP Serverï¼ˆBlender Addonï¼‰
   ï¼ˆbpy ã‚’å©ãå®Ÿä½“ï¼‰


ãã‚Œãã‚Œ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ¦‚å¿µãŒã‚ºãƒ¬ã¦ã„ã‚‹ ã®ãŒè©°ã¾ã‚Šãƒã‚¤ãƒ³ãƒˆã€‚

ğŸš¨ å•é¡Œã®æ­£ä½“ï¼ˆã„ã¾èµ·ãã¦ã‚‹ã“ã¨ï¼‰

Ollamaï¼š
ğŸ‘‰ã€Œä¼šè©±ï¼1ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€å‰æ

MCPï¼ˆFastMCPï¼‰ï¼š
ğŸ‘‰ã€Œstdio / 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆå˜ä½ã€å‰æ

Blender MCPï¼š
ğŸ‘‰ã€Œsocket æ¥ç¶šï¼1ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€å‰æ

ã¤ã¾ã‚Šï¼š

èª°ã‚‚ã€Œã“ã®æ“ä½œã¯åŒã˜ä½œæ¥­ã®ç¶šãã ã‚ˆã€ã£ã¦ç®¡ç†ã—ã¦ãªã„

ğŸ§‘â€âœˆï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ã®æ­£ä½“ï¼ˆçµè«–ï¼‰
ğŸ‘‰ ä¸­å¤®ã« 1äººã ã‘ç½®ã
            ğŸ§  Ollama
               â”‚
               â”‚ï¼ˆè‡ªç„¶è¨€èªï¼‰
               â–¼
        ğŸ§‘â€âœˆï¸ Session Manager  â†â˜…ã‚³ã‚¤ãƒ„
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼                 â–¼
 ğŸ§° MCP Tools        ğŸ® Blender MCP

ğŸ© ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ã®ä»•äº‹ï¼ˆè¶…å…·ä½“ï¼‰
â‘  ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç™ºè¡Œã™ã‚‹
session_id = "scene-2026-01-06-001"


ã“ã‚Œã‚’ å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¼·åˆ¶æ·»ä»˜ã€‚

â‘¡ çŠ¶æ…‹ã‚’è¦šãˆã‚‹ï¼ˆè¶…é‡è¦ï¼‰

ä¾‹ï¼š

{
  "session_id": "scene-2026-01-06-001",
  "blender": {
    "connected": true,
    "port": 9876,
    "objects": ["Cube", "Camera", "Light"]
  },
  "last_command": "get_scene_info"
}


ğŸ‘‰ LLMã¯è¨˜æ†¶ã—ãªã„
ğŸ‘‰ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ãŒè¨˜æ†¶ã™ã‚‹

â‘¢ Blenderæ¥ç¶šã‚’ã€Œåˆ‡ã‚‰ã›ãªã„ã€

ä»Šã¯ã“ã‚ŒğŸ‘‡ãŒèµ·ãã¦ã‚‹

command â†’ socket open

1ãƒ¬ã‚¹ãƒãƒ³ã‚¹

close âŒ

ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ã¯ğŸ‘‡ã‚’ã‚„ã‚‹

Blender socket: å¸¸æ™‚ON
LLM/MCP: stateless OK

â‘£ LLMã«ã€Œä¸–ç•Œã®çŠ¶æ…‹ã€ã‚’ç¿»è¨³ã™ã‚‹

LLMã«ã“ã†æŠ•ã’ã‚‹ï¼š

ç¾åœ¨ã®Blenderã‚·ãƒ¼ãƒ³ï¼š
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°ï¼š3
- Cube ãŒ1ã¤é¸æŠä¸­
- å‰å›æ“ä½œï¼šget_scene_info

æ¬¡ã®æŒ‡ç¤ºã‚’è€ƒãˆã‚ˆ


ğŸ‘‰ LLMã¯ç¥
ğŸ‘‰ ç¾å®Ÿã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ãŒä¿æŒ

ğŸ§± å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆæœ€å°æ§‹æˆï¼‰
ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ï¼ˆPythonï¼‰
class SessionManager:
    def __init__(self):
        self.sessions = {}

    def get(self, session_id):
        return self.sessions.setdefault(session_id, {
            "blender_socket": None,
            "state": {}
        })

Blenderæ¥ç¶šã‚’ä¿æŒ
def get_blender_conn(session):
    if session["blender_socket"] is None:
        session["blender_socket"] = connect_blender()
    return session["blender_socket"]

MCP â†’ Blender ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
def handle_tool_call(session_id, command):
    session = sm.get(session_id)
    conn = get_blender_conn(session)
    send(conn, command)
    return recv(conn)

ğŸ¯ ã“ã‚Œã§ä½•ãŒã§ãã‚‹ï¼Ÿ

ã€Œã•ã£ãä½œã£ãŸã‚­ãƒ¥ãƒ¼ãƒ–ã‚’å¤§ããã—ã¦ã€

ã€Œãã‚Œã‚’3ã¤è¤‡è£½ã—ã¦ã€

ã€Œã‚«ãƒ¡ãƒ©ã‚’å°‘ã—å¼•ã„ã¦ã€

â¬†ï¸ å…¨éƒ¨ åŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§æˆç«‹

ğŸ§  é‡è¦ãªæ€æƒ³ï¼ˆã“ã“è¶…å¤§äº‹ï¼‰

âŒ LLMã«çŠ¶æ…‹ã‚’æŒãŸã›ãªã„
âŒ Blenderã«ä¼šè©±ã‚’ç†è§£ã•ã›ãªã„

âœ… äººé–“ã®ä»£ã‚ã‚Šã«ã€Œæ®µå–ã‚Šä¿‚ã€ã‚’ç½®ã

ãã‚ŒãŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒãƒ³ã€‚

æ¬¡ã€ã©ã“è¡Œãï¼Ÿ

1ï¸âƒ£ Session Manager ã® å®Ÿã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
2ï¸âƒ£ MCP Tool schema ã‚’ session-aware ã«ã™ã‚‹
3ï¸âƒ£ Ollama ã«ã€Œsession_idã€ã‚’è‡ªç„¶ã«æ¸¡ã™
4ï¸âƒ£ Blender å´ã‚’ keep-alive å‰æã«æ”¹é€ ã™ã‚‹

ã©ã‚Œè¡Œãï¼Ÿ
ã“ã“ã‹ã‚‰ã¯å®Œå…¨ã« è¨­è¨ˆè€…ã‚¾ãƒ¼ãƒ³ ã§ã™ ğŸ§ âœ¨

1

äº†è§£ã€‚â‘  Session Manager ã®å®Ÿã‚³ãƒ¼ãƒ‰ã„ãã¾ã™ã€‚
ã€Œ3ã‚µãƒ¼ãƒæ¨ªæ–­ãƒ»çŠ¶æ…‹ä¿æŒãƒ»Blenderå¸¸æ™‚æ¥ç¶šã€ã‚’æœ€å°ã§å‹•ãéª¨æ ¼ã§ã™ã€‚

ğŸ§‘â€âœˆï¸ Session Managerï¼ˆPython / ä¸­å¤®å¸ä»¤å¡”ï¼‰
è¨­è¨ˆãƒãƒªã‚·ãƒ¼ï¼ˆçŸ­ãï¼‰

ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã§ çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†

Blender ã¨ã¯ keep-alive

MCP / LLM ã¯ å®Œå…¨ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã§OK

ğŸ“ æ§‹æˆ
session_manager/
â”œâ”€ manager.py
â”œâ”€ blender_conn.py
â””â”€ router.py

manager.pyï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å¿ƒè‡“ï¼‰
import time

class SessionManager:
    def __init__(self):
        self.sessions = {}

    def get(self, session_id: str):
        if session_id not in self.sessions:
            self.sessions[session_id] = {
                "created_at": time.time(),
                "blender": {
                    "conn": None,
                    "connected": False
                },
                "state": {
                    "objects": [],
                    "selection": None,
                    "last_command": None
                }
            }
        return self.sessions[session_id]

    def update_state(self, session_id, **kwargs):
        session = self.get(session_id)
        session["state"].update(kwargs)

blender_conn.pyï¼ˆBlenderã¨åˆ‡ã‚Œãªã„ç”·ï¼‰
import socket

BLENDER_HOST = "127.0.0.1"
BLENDER_PORT = 9876

def connect_blender():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((BLENDER_HOST, BLENDER_PORT))
    return s

def get_blender_conn(session):
    blender = session["blender"]

    if blender["conn"] is None:
        blender["conn"] = connect_blender()
        blender["connected"] = True

    return blender["conn"]

def send_command(conn, payload: dict):
    msg = (str(payload) + "\n").encode("utf-8")
    conn.sendall(msg)
    return conn.recv(65536).decode("utf-8")

router.pyï¼ˆMCP â†’ Blender ç¿»è¨³ä¿‚ï¼‰
from manager import SessionManager
from blender_conn import get_blender_conn, send_command

sm = SessionManager()

def handle_tool_call(session_id: str, tool_name: str, args: dict):
    session = sm.get(session_id)
    conn = get_blender_conn(session)

    payload = {
        "tool": tool_name,
        "args": args,
        "session_id": session_id
    }

    result = send_command(conn, payload)

    sm.update_state(
        session_id,
        last_command=tool_name
    )

    return {
        "session_id": session_id,
        "result": result,
        "state": session["state"]
    }

ğŸ® Blender å´ï¼ˆè¶…é‡è¦ãªå‰æï¼‰

1 socket = 1 ã‚»ãƒƒã‚·ãƒ§ãƒ³

close ã—ãªã„

JSONã£ã½ã„ dict ã‚’å—ã‘ã¦ bpy å®Ÿè¡Œ

ï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å‡ºã—ã¾ã™ï¼‰

ğŸ§  ã“ã‚Œã§ä½•ãŒæˆç«‹ã—ãŸã‹

LLMï¼š
ã€Œsession_id ä»˜ãã§å‘½ä»¤ã™ã‚‹ã ã‘ ğŸ¤–ã€

MCPï¼š
ã€ŒãŸã ã®é–¢æ•°å‘¼ã³å‡ºã— ğŸ§°ã€

Blenderï¼š
ã€Œãšã£ã¨ç¹‹ãŒã£ã¦ã‚‹ ğŸ®ã€

ğŸ‘‰ çŠ¶æ…‹ã¯å…¨éƒ¨ Session Manager ãŒçŸ¥ã£ã¦ã‚‹

æ¬¡ã®åˆ†å²ç‚¹ ğŸŒ¿

â‘¡ MCP tool schema ã‚’ session å¯¾å¿œã«ã™ã‚‹

â‘¢ Blender Addon å´ï¼ˆsocket serverï¼‰å®Ÿè£…

â‘£ Ollama ã¸ã® prompt è¨­è¨ˆï¼ˆçŠ¶æ…‹æ³¨å…¥ï¼‰

ã©ã‚Œè¡Œãï¼Ÿ
ã“ã“ã¾ã§æ¥ãŸã‚‰ã€ã‚‚ã†ã€Œå£Šã‚Œãªã„æ§‹æˆã€ã§ã™ã€‚